---
layout: post
title: "[ë²ˆì—­] ìë°”ìŠ¤í¬ë¦½íŠ¸ ì´ë²¤íŠ¸ ë£¨í”„"
date: 2020-06-07
categories: [JavaScript, Eventloop]
disqus_comments: true
toc:
  sidebar: left
---

> ì´ ê¸€ì€ ì›ì €ì [Lydia Hallie](https://dev.to/lydiahallie) ì˜ í—ˆë½ì„ ë°›ì•„ [âœ¨â™»ï¸ JavaScript Visualized: Event Loop](https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif) ì„ ë²ˆì—­í•œ ê¸€ì…ë‹ˆë‹¤

### ì´ë²¤íŠ¸ ë£¨í”„ ì´í•´í•˜ê¸°

`ì´ë²¤íŠ¸ ë£¨í”„`! 
ëª¨ë“  JavaScript ê°œë°œìë“¤ì´ ì•Œì•„ì•¼ í•˜ëŠ” ê°œë… ì¤‘ í•˜ë‚˜ì§€ë§Œ, ì²˜ìŒì—ëŠ” ë‹¤ì†Œ ê·¸ ê°œë…ì„ ì´í•´í•˜ê¸°ê°€ í˜¼ë€ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì €ëŠ” ì‹œê°ì  í•™ìŠµìë¡œì„œ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ì‹œê°ì ì¸ ë°©ë²•ì„ í†µí•´ ì´í•´í•˜ê³ ì í•©ë‹ˆë‹¤.

ë¨¼ì €, ì´ë²¤íŠ¸ ë£¨í”„ë€ ë¬´ì—‡ì´ë©° ì™œ ê´€ì‹¬ì„ ê°€ì ¸ì•¼ í• ê¹Œìš”?

JavaScriptëŠ” `ì‹±ê¸€ ìŠ¤ë ˆë“œ`ë¡œ, í•œ ë²ˆì— í•˜ë‚˜ì˜ ì‘ì—…ë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì¦‰ í•˜ë‚˜ì˜ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹¤í–‰ì´ ëë‚  ë•Œê¹Œì§€ëŠ” ë‹¤ë¥¸ ì–´ë–¤ ì‘ì—…ë„ ì¤‘ê°„ì— ë¼ì–´ë“¤ì§€ ëª»í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ ì´ëŠ” í° ë¬¸ì œëŠ” ì•„ë‹ˆì§€ë§Œ, 30ì´ˆë¼ëŠ” ê¸´ ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì–´ë–¤ ì‘ì—…ì„ ì‹¤í–‰í•˜ê³  ìˆë‹¤ê³  ìƒê°í•´ë´…ì‹œë‹¤.

í•´ë‹¹ ì‘ì—…ì´ ëë‚  ë™ì•ˆ ë‹¤ë¥¸ ì‘ì—…ë“¤ì€ ëŒ€ê¸°í•˜ê³  ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
(JavaScriptëŠ” ë¸Œë¼ìš°ì €ì˜ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ, ì „ì²´ UI ë Œë”ë§ ì—­ì‹œ ì¤‘ë‹¨ë©ë‹ˆë‹¤ ğŸ˜¬)

2020ë…„ì¸ ì§€ê¸ˆ- ì›ë¬¸ì—ëŠ” 2019ë…„-, ì–´ëŠ ëˆ„êµ¬ë„ ëŠë¦¬ê²Œ ë°˜ì‘í•˜ëŠ” ì›¹ ì‚¬ì´íŠ¸ë¥¼ ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì¼ë°˜ì ìœ¼ë¡œ ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì‚¬ìš©ë˜ëŠ” í™˜ê²½ì„ ìƒê°í•´ë³´ë©´ ë™ì‹œì— ë§ì€ ì‘ì—…ë“¤ì´ ì²˜ë¦¬ë˜ê³¤ í•©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, Node.js ê¸°ë°˜ì˜ ì›¹ ì„œë²„ëŠ” ë™ì‹œì— ì—¬ëŸ¬ ê°œì˜ HTTP ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸°ë„ í•˜ë©°,
ì›¹ ë¸Œë¼ìš°ì €ì—ì„œëŠ” í´ë¦­ì´ë‚˜ ìŠ¤í¬ë¡¤ ë“±ì˜ ë§ˆìš°ìŠ¤ ì…ë ¥ì„ ì²˜ë¦¬í•˜ë©´ì„œ ë™ì‹œì— ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ë³´ì—¬ì£¼ê¸°ë„ í•©ë‹ˆë‹¤.

ë‹¤í–‰ì´ë„, ë¸Œë¼ìš°ì €ëŠ” JavaScript ì—”ì§„ ìì²´ì—ì„œ ì œê³µí•˜ì§€ ì•ŠëŠ” ì¼ë¶€ ê¸°ëŠ¥ì¸ `Web API`ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
Web APIì—ëŠ” `DOM API, setTimeout, HTTP requests` ë“±ì´ í¬í•¨ë©ë‹ˆë‹¤.
ì´ë“¤ì€ ë¹„ë™ê¸°ì ì´ê³  (async), non-blockingí•œ ë™ì‘ë“¤ì„ ë§Œë“œëŠ”ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ, ì´ëŠ” `í˜¸ì¶œ ìŠ¤íƒ (call stack)` ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ê³³ì— ì¶”ê°€ë©ë‹ˆë‹¤.
í˜¸ì¶œ ìŠ¤íƒì€ JavaScript ì—”ì§„ì˜ ì¼ë¶€ë¡œ, ë¸Œë¼ìš°ì €ë³„ë¡œ ê·¸ ëª…ì„¸ì— ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.
ì–´ì¨Œê±°ë‚˜, í˜¸ì¶œ ìŠ¤íƒì€ ì´ë¦„ ê·¸ëŒ€ë¡œ **ìŠ¤íƒ**ìœ¼ë¡œ, Last-In, First-Out (LIFO) êµ¬ì¡°ë¥¼ ê°€ì§‘ë‹ˆë‹¤.
í•¨ìˆ˜ê°€ ê°’ì„ ë°˜í™˜í•˜ë©´, ê·¸ ê°’ì€ ìŠ¤íƒìœ¼ë¡œë¶€í„° íŠ€ì–´ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤. ğŸ‘‹

{% include figure.liquid loading="eager" path="/assets/img/posts/event-loop-call-stack.gif" class="img-fluid rounded z-depth-1" %}


ìœ„ì—ì„œ `respond` í•¨ìˆ˜ëŠ” `setTimeout` í•¨ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
`setTimeout`ì€ Web APIì— ì˜í•´ ì œê³µë˜ë©°, ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šê³  ì‘ì—…ì„ ì§€ì—°ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

`setTimeout` í•¨ìˆ˜ì— ì „ë‹¬í•œ ì½œë°± í•¨ìˆ˜ì¸ í™”ì‚´í‘œ í•¨ìˆ˜ `() => { return 'Hey' }`ëŠ” Web APIì— ì¶”ê°€ë©ë‹ˆë‹¤.
ë‘ ë²ˆì§¸ ì¸ìë¡œ ì „ë‹¬í•œ ê°’ì— ë”°ë¼, í•´ë‹¹ ì½œë°± í•¨ìˆ˜ëŠ” ì¼ì • ì‹œê°„ ê·¸ ì‘ì—…ì´ ì§€ì—°ëœ í›„ ì‹¤í–‰ë©ë‹ˆë‹¤.
setTimeout í•¨ìˆ˜ì™€ respond í•¨ìˆ˜ëŠ” ìŠ¤íƒì—ì„œ íŠ€ì–´ ë‚˜ì™€, ê°ê°ì˜ ê°’ì„ ë°˜í™˜í•˜ê²Œ ë©ë‹ˆë‹¤.

{% include figure.liquid loading="eager" path="/assets/img/posts/event-loop-call-stack2.gif" class="img-fluid rounded z-depth-1" %}

Web APIì—ì„œ, íƒ€ì´ë¨¸ëŠ” ì „ë‹¬ëœ ë‘ ë²ˆì§¸ ì¸ìˆ˜ ê°’ì¸ 1000ms ë™ì•ˆ ì‹¤í–‰ë©ë‹ˆë‹¤.
ì½œë°±ì€ ì¦‰ì‹œ í˜¸ì¶œ ìŠ¤íƒì— ì¶”ê°€ë˜ì§€ ì•ŠëŠ” ëŒ€ì‹ , `íƒœìŠ¤í¬ í (Task Queue)`ë¼ëŠ” ê³³ì— ì „ë‹¬ë©ë‹ˆë‹¤.

{% include figure.liquid loading="eager" path="/assets/img/posts/event-loop-queue.gif" class="img-fluid rounded z-depth-1" %}

ì—¬ê¸°ê°€ í˜¼ë€ìŠ¤ëŸ¬ìš´ ë¶€ë¶„ì…ë‹ˆë‹¤.
1000ms í›„ì— ì½œë°± í•¨ìˆ˜ê°€ í˜¸ì¶œ ìŠ¤íƒì— ì¶”ê°€ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
1000ms í›„ì— `íƒœìŠ¤í¬ íì— ì¶”ê°€ë©ë‹ˆë‹¤`.
íƒœìŠ¤í¬ íëŠ” ë§ ê·¸ëŒ€ë¡œ ì½œë°± í•¨ìˆ˜ë“¤ì´ ëŒ€ê¸°í•˜ëŠ” í(FIFO:First-in, First-Out) í˜•íƒœì˜ ë°°ì—´ì…ë‹ˆë‹¤.

ì´ì œ ìš°ë¦¬ê°€ ê¸°ë‹¤ë ¸ë˜ ë¶€ë¶„ì…ë‹ˆë‹¤. **ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œë°± í•¨ìˆ˜ê°€ ë‹´ê¸´ íë¥¼ í˜¸ì¶œ ìŠ¤íƒì— ì—°ê²°í•©ë‹ˆë‹¤**.
ë§Œì•½ í˜¸ì¶œ ìŠ¤íƒì´ ë¹„ì–´ìˆë‹¤ë©´ (ì¦‰ ì´ì „ì— í˜¸ì¶œëœ ëª¨ë“  í•¨ìˆ˜ê°€ ê·¸ ê°’ì„ ë°˜í™˜í•˜ê³  ëª¨ë‘ ìŠ¤íƒì—ì„œ íŠ€ì–´ ë‚˜ì˜¨ ìƒíƒœë¼ë©´), ì´ë²¤íŠ¸ ë£¨í”„ëŠ” íì—ì„œ í˜¸ì¶œ ìŠ¤íƒì„ êº¼ë‚´ì™€ì„œ ì´ë¥¼ í˜¸ì¶œ ìŠ¤íƒì— ì¶”ê°€í•©ë‹ˆë‹¤.
ì´ ê²½ìš°ì—ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ëŠ” í˜¸ì¶œë˜ì§€ ì•Šì•˜ëŠ”ë°, ì´ëŠ” ì½œë°± í•¨ìˆ˜ê°€ ì´ë²¤íŠ¸ ë£¨í”„ì— ì˜í•´ íì˜ ì²« ë²ˆì§¸ í•­ëª©ìœ¼ë¡œ ì¶”ê°€ë˜ê¸° ì „ê¹Œì§€ í˜¸ì¶œ ìŠ¤íƒì´ ë¹„ì–´ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

> MDNì˜ ì´ë²¤íŠ¸ ë£¨í”„ ê´€ë ¨ ë‚´ìš©ì„ ë³´ë©´, ì™œ ì´ë²¤íŠ¸ **'ë£¨í”„'** ë¼ëŠ” ì´ë¦„ì´ ë¶™ì—ˆëŠ”ì§€ë¥¼ ê°„ë‹¨í•œ ì½”ë“œì™€ í•¨ê»˜ ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤.
> `waitForMessage` ë©”ì†Œë“œëŠ” í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ì„ ë•Œ (ì¦‰, í˜¸ì¶œ ìŠ¤íƒì´ ë¹„ì–´ìˆì„ ë•Œ), ë‹¤ìŒ ì‘ì—…ì´ íƒœìŠ¤í¬ íì— ì¶”ê°€ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤. 

{% highlight javascript linenos%}
while (queue.waitForMessage()) {
   queue.processNextMessage()
 }
{% endhighlight %}

---

{% include figure.liquid loading="eager" path="/assets/img/posts/event-loop-queue2.gif" class="img-fluid rounded z-depth-1" %}

ì½œë°± í•¨ìˆ˜ê°€ í˜¸ì¶œ ìŠ¤íƒì— ì¶”ê°€ë˜ë©´, í˜¸ì¶œë˜ê³  ê·¸ ê²°ê³¼ ê°’ì„ ë°˜í™˜í•œ ë’¤ ìŠ¤íƒìœ¼ë¡œë¶€í„° íŠ€ì–´ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.

{% include figure.liquid loading="eager" path="/assets/img/posts/event-loop-queue3.gif" class="img-fluid rounded z-depth-1" %}

### ì˜ˆì œ

ë‹¤ìŒì„ ì‹¤í–‰í•˜ë©´ ì½˜ì†”ì— ì–´ë–»ê²Œ ì¶œë ¥ë ê¹Œìš”?

{% highlight javascript linenos%}
const foo = () => console.log("First");
const bar = () => setTimeout(() => console.log("Second"), 500);
const baz = () => console.log("Third");

bar();
foo();
baz();
{% endhighlight%}

ì´í•´ ë˜ì…¨ë‚˜ìš”?
ë¸Œë¼ìš°ì €ì—ì„œ í•´ë‹¹ ì½”ë“œë¥¼ ì‹¤í–‰í•  ë•Œ ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ëŠ”ì§€ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë´…ì‹œë‹¤.

{% include figure.liquid loading="eager" path="/assets/img/posts/event-loop-example.gif" class="img-fluid rounded z-depth-1" %}

1. `bar` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. barëŠ” `setTimeout` í•¨ìˆ˜ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
2. ì „ë‹¬ëœ setTimeout ì½œë°± í•¨ìˆ˜ëŠ” Web API (í˜¹ì€ ë°±ê·¸ë¼ìš´ë“œë¼ê³  ë¶ˆë¦¬ê¸°ë„ í•¨)ì— ì¶”ê°€ë˜ê³ , setTimeoutê³¼ bar í•¨ìˆ˜ëŠ” ì‹¤í–‰ ìŠ¤íƒìœ¼ë¡œë¶€í„° íŠ€ì–´ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.
3. íƒ€ì´ë¨¸ê°€ ì‹¤í–‰ë˜ê³ , ê·¸ ë™ì•ˆ `foo`ê°€ í˜¸ì¶œë˜ì–´ `First`ê°€ ì½˜ì†”ì— ê¸°ë¡ë©ë‹ˆë‹¤. `foo`ëŠ” return êµ¬ë¬¸ì´ ì—†ì–´ ê·¸ ë°˜í™˜ê°’ì€ `undefined`ì…ë‹ˆë‹¤. ì´ì–´ì„œ `baz`ê°€ í˜¸ì¶œë˜ê³ , ì½œë°± í•¨ìˆ˜ëŠ” íì— ì¶”ê°€ë©ë‹ˆë‹¤.
4. `baz`ì˜ `Third`ê°€ ì½˜ì†”ì— ê¸°ë¡ë©ë‹ˆë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ëŠ” í˜¸ì¶œ ìŠ¤íƒì´ ë¹„ì—ˆìŒì„ í™•ì¸í•˜ê³ , íì— ìˆëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ í˜¸ì¶œ ìŠ¤íƒì— ì¶”ê°€í•©ë‹ˆë‹¤.
5. ì½œë°± í•¨ìˆ˜ì˜ `Second`ê°€ ì½˜ì†”ì— ê¸°ë¡ë©ë‹ˆë‹¤.

ìœ„ì˜ ë‚´ìš©ì„ í†µí•´ ì´ë²¤íŠ¸ ë£¨í”„ì— ëŒ€í•´ ì¢€ ë” ìµìˆ™í•´ì¡Œê¸¸ ë°”ëë‹ˆë‹¤ ğŸ’ªğŸ¼

---

ğŸ”— ì°¸ì¡°

ğŸ“Œ [JavaScript Visualized:: Event Loop](https://dev.to/lydiahallie/javascript-visualized-event-loop-3dif)

ğŸ“Œ [Concurrency model and the event loop:: MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)

ğŸ“Œ [Nodejs Event Loop :: StackOverflow](https://stackoverflow.com/questions/10680601/nodejs-event-loop)
